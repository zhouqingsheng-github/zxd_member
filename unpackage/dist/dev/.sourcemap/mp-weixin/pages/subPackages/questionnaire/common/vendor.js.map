{"version":3,"sources":["uni-app:///common/auth.js"],"names":["isLoggedIn","getToken","handleLoginRequired","options","autoLogin","isValid","success","clearUserInfo","setRedirectInfo","url","params","type","registerChannel","hotelId","uni","navigateTo"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACO,IAAMA,UAAU,GAAG,SAAbA,UAAU,GAAS;EAC5B,OAAO,CAAC,CAAC,IAAAC,eAAQ,GAAE;AACvB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAUO,IAAMC,mBAAmB;EAAA,mFAAG,iBAAOC,OAAO;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA,KACzCH,UAAU,EAAE;cAAA;cAAA;YAAA;YAAA;YAAA,OAEU,IAAAI,gBAAS,GAAE;UAAA;YAA3BC,OAAO;YAAA,KACTA,OAAO;cAAA;cAAA;YAAA;YACP;YACAF,OAAO,CAACG,OAAO,IAAIH,OAAO,CAACG,OAAO,EAAE;YAAC;UAAA;YAGzC;YACA,IAAAC,oBAAa,GAAE;UAAC;YAGpB;YACA,IAAAC,yBAAe,EAAC;cACZC,GAAG,EAAEN,OAAO,CAACM,GAAG;cAChBC,MAAM,EAAEP,OAAO,CAACO,MAAM;cACtBC,IAAI,EAAE,MAAM;cACZC,eAAe,EAAET,OAAO,CAACS,eAAe;cACxCC,OAAO,EAAEV,OAAO,CAACU;YACrB,CAAC,CAAC;YACF;YAAA;YAAA,OACMC,GAAG,CAACC,UAAU,CAAC;cACjBN,GAAG,EAAE;YACT,CAAC,CAAC;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACL;EAAA,gBAzBYP,mBAAmB;IAAA;EAAA;AAAA,GAyB/B;AAAC,kD","file":"pages/subPackages/questionnaire/common/vendor.js","sourcesContent":["import { getToken, autoLogin, clearUserInfo } from '@/store/index.js'\nimport { setRedirectInfo } from './redirect.js'\n\n/**\n * 检查用户是否已登录\n * @returns {boolean} 是否已登录\n */\nexport const isLoggedIn = () => {\n    return !!getToken();\n};\n\n/**\n * 处理需要登录的操作\n * @param {Object} options 选项\n * @param {string} options.url 当前页面URL\n * @param {Object} options.params 当前页面参数\n * @param {string} options.registerChannel 注册渠道（探探糖、WIFI二维码等）\n * @param {number} options.hotelId 酒店ID\n * @param {Function} options.success 登录成功后的回调\n * @param {Function} options.fail 登录失败的回调\n */\nexport const handleLoginRequired = async (options) => {\n    if (isLoggedIn()) {\n        // 如果本地有token，进一步验证token有效性\n        const isValid = await autoLogin();\n        if (isValid) {\n            // Token有效，执行成功回调\n            options.success && options.success();\n            return;\n        }\n        // Token无效，清除用户信息，继续执行登录流程\n        clearUserInfo();\n    }\n\n    // 保存当前页面信息，包括注册渠道和酒店ID\n    setRedirectInfo({\n        url: options.url,\n        params: options.params,\n        type: 'page',\n        registerChannel: options.registerChannel,\n        hotelId: options.hotelId\n    });\n    // 跳转到登录页面\n    await uni.navigateTo({\n        url: '/pages/subPackages/user/login'\n    });\n}; "],"sourceRoot":""}